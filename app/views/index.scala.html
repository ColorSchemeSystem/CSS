@(user: Member, chooser: Chooser, path: String, tags: List[String])

@main("Color Scheme", user){ 
<script>

$(window).load(function(){
	fixFrameSize();
	var navi = $('.fixnav');
		var main  = $('.main');
		var target_top = navi.offset().top - parseInt(navi.css('margin-top'),10);
		var sub_top = main.offset().top - parseInt(main.css('margin-top'),10);
		var sub_scroll = main.offset().top + main.outerHeight(true) - navi.outerHeight(true) - parseInt(navi.css('margin-top'),10);

		if (navi.outerHeight(true) + target_top < main.outerHeight(true) + sub_top) {
		$(window).scroll(function () {
			var ws = $(window).scrollTop();
			$('.scroll').text(ws);
			if (ws > sub_scroll) {
			navi.css({position:'fixed', top: sub_scroll - ws + 'px'});
			} else if(ws > target_top) {
			navi.css({position:'fixed', top: '0px'});
			} else {
			navi.css({position:'relative', top: '0px'});
			}
		});
	}
});

function fixFrameSize() {
	if (window.parent) {
		var body = document.body;
		var height = body.scrollHeight;
		var iframe = window.parent.document.getElementsByTagName("iframe")[0];
		iframe.style.height = height + "px";
		iframe.scrolling = "no";
	}
};

function display(name) {
	$(name).toggle();
}

function sendHTML(){
	var ele = $("<input>", {
					"type" : "hidden",
					"name" : "tempHtml",
					"value" : $('iframe').contents().find('html').html()
				});
	$('#sendForm').append(ele);
};

function addTr(classname) {
	var CN = classname;
	var td = $("<td></td>",{
		text : classname
	});
	classname = "." + classname;
	//console.log(td);
	var td2 = $("<td>COLOR</td>");
	//console.log(td2);
	var tr = $("<tr></tr>",{
		on : {
			/*mouseover : function(event){
				//console.log(classname);
				var content = $('iframe').contents().find(classname);
				var element = $("<div></div>", {
						"class" : "hoverImage"
				});
				//console.log("オブジェクト作成");
				var css = {
					color : "red",
					position : "absolute",
					width : content.innerWidth(),
					height : content.innerHeight(),
					background : "red",
					filter : "alpha(opacity = 30)",
					MozOpacity : 0.3,
					opacity : 0.3
				};
				//console.log("css設定");
				content.css("position", "relative");
				element.css(css);
				element.css("top", 0);
				element.css("left", 0);
				element.css("z-index", 1000);
				//console.log("cssセット")
				content.append(element);
				//console.log("要素代入")
			},
			mouseout : function(classname){
				//console.log("マウスアウト");
				var content = $('iframe').contents().find(classname);
				//console.log("要素の見つける");
				content.css("position", "");
				//console.log("css削除");
				$('iframe').contents().find('.hoverImage').remove();
			},*/
			click : function(event) {
				$(".iframe"+CN).each(function() {
					display($(this));
				});
			}
		}
	});
	tr.append(td);
	tr.append(td2);
	tr.css("background-color", "#AAA");
	$('#classTable').append(tr);
};
/*
function addTrAndTrInTdTab(classname,childName) {
	var CN = classname;
	var td = $("<td></td>",{
		text : classname
	});
	classname = "." + classname;
	//console.log(td);
	var td2 = $("<td>COLOR</td>");
	//console.log(td2);
	var tr = $("<tr></tr>",{
		on : {
			click : function(event) {
				$(".iframe"+CN).each(function() {
					display($(this));
				});
			}
		}
	});
	tr.append(td);
	tr.append(td2);
	tr.css("background-color", "#AAA");
	$('#classTable').append(tr);
};
*/
function addTrInHideTab(parentName,classname) {
	var CN = classname;
	var td = $("<td></td>",{
		text : classname
	});
	classname = "." + classname;
	//console.log(td);
	var td2 = $("<td>COLOR</td>");
	//console.log(td2);
	var tr = $("<tr></tr>",{
		"class": "iframe"+parentName,
		on : {
			mouseover : function(event){
				//console.log(classname);
				var content = $('iframe').contents().find(classname);
				var element = $("<div></div>", {
						"class" : "hoverImage"
				});
				//console.log("オブジェクト作成");
				var css = {
					color : "red",
					position : "absolute",
					width : content.innerWidth(),
					height : content.innerHeight(),
					background : "red",
					filter : "alpha(opacity = 30)",
					MozOpacity : 0.3,
					opacity : 0.3
				};
				//console.log("css設定");
				content.css("position", "relative");
				element.css(css);
				element.css("top", 0);
				element.css("left", 0);
				element.css("z-index", 1000);
				//console.log("cssセット")
				content.append(element);
				//console.log("要素代入")
			},
			mouseout : function(classname){
				//console.log("マウスアウト");
				var content = $('iframe').contents().find(classname);
				//console.log("要素の見つける");
				content.css("position", "");
				//console.log("css削除");
				$('iframe').contents().find('.hoverImage').remove();
			},
			click : function(event) {
				console.log("くりっく");
				$(".iframe"+CN).each(function() {
					display($(this));
				});
			}
		}
	});
	tr.append(td);
	tr.append(td2);
	tr.css("display", "none");
	tr.css("background-color", "#AAA");
	$('#classTable').append(tr);
};

function addColorSchemeFromSelectElement(classname) {
	addBackground(classname);
};

function addTabTr(classname) {
	addTr(classname);
	$('iframe').contents().find("."+classname).children().each(function() {
		var childClassName = $(this).attr("class");
		console.log(classname+"子供います"+childClassName);
		addTrInHideTab(classname,childClassName);
		addColorSchemeFromSelectElement(childClassName);
	});
};

function addBackground(name) {
	var tr = $("<tr class='iframe"+name+"'></tr>");
	var td = $("<td>background</td>");
	var td2 = $("<input type='text' class='form-control' id='"+name+"-back' value='#A6FF00' data-color-format='hex'>");

	tr.append(td);
	tr.append(td2);
	tr.css("display", "none");
	$('#classTable').append(tr);
	var classname = "." + name;

	var color = $('iframe').contents().find(classname).css("background-color");
	if(color == 'rgba(0, 0, 0, 0)') color = 'rgb(255, 255, 255)';
	$("#"+name+"-back").val(color);

	// タグがulだったら
	//console.log($('iframe').contents().find(classname).prop("tagName"));
	if($('iframe').contents().find(classname).prop("tagName") == "UL") {
		//console.log("UL");
	}

	var dataBack = {contentName:classname, targetName:"background"};
	$("input#"+name+"-back").ColorPickerSliders({
		placement: $('#chooser').data('placement'),
		hsvpanel: $('#chooser').data('hsvpanel'),
		sliders: $('#chooser').data('sliders'),
		swatches: $('#chooser').data('swatches'),
		previewformat: 'hex'
	},dataBack);
};

function addBorder(name) {
	var tr = $("<tr class='iframe"+name+"'></tr>");
	var td = $("<td>border</td>");
	var td2 = $("<input type='text' class='form-control' id='"+name+"-bor' value='#A6FF00' data-color-format='hex'>");

	tr.append(td);
	tr.append(td2);
	tr.css("display", "none");
	$('#classTable').append(tr);
	var classname = "." + name;

	var color = $('iframe').contents().find(classname).css('border-color');
	$("#"+name+"-bor").val(color);

	var dataBorder = {contentName:classname, targetName:"border"};
	$("input#"+name+"-bor").ColorPickerSliders({
		placement: $('#chooser').data('placement'),
		hsvpanel: $('#chooser').data('hsvpanel'),
		sliders: $('#chooser').data('sliders'),
		swatches: $('#chooser').data('swatches'),
		previewformat: 'hex'
	},dataBorder);
}

function addFont(name) {
	var tr = $("<tr class='iframe"+name+"'></tr>");
	var td = $("<td>font</td>");
	var td2 = $("<input type='text' class='form-control' id='"+name+"-font' value='#A6FF00' data-color-format='hex'>");

	tr.append(td);
	tr.append(td2);
	tr.css("display", "none");
	$('#classTable').append(tr);
	var classname = "." + name;

	var color = $('iframe').contents().find(classname).css('color');
	$("#"+name+"-font").val(color);

	var dataFont = {contentName:classname, targetName:"font"};
	$("input#"+name+"-font").ColorPickerSliders({
		placement: $('#chooser').data('placement'),
		hsvpanel: $('#chooser').data('hsvpanel'),
		sliders: $('#chooser').data('sliders'),
		swatches: $('#chooser').data('swatches'),
		previewformat: 'hex'
	},dataFont);
}

</script>


<div id="chooser" data-placement="'@chooser.placement'" data-hsvpanel="@chooser.hsvpanel" data-sliders="@chooser.slider" data-swatches="@chooser.swatche"></div>
	<div class="main">
		<div class="inHtml">
			<iframe src="@routes.Assets.at(path)" width="920px" name="template" id="iframe"></iframe>
			<script>
				$('#iframe').load(function(){
					//console.log("実行");
					var elements = new Array();
					elements = $('#iframe').contents().find('*');
					//console.log($('#iframe').contents().find('*'));
					$.each(elements, function(index, item){
						var classname = item.className.split(" ")[0];
						if(classname != ""){
							//if($('iframe').contents().find(classname).children())
							//console.log($('iframe').contents().find("."+classname).children().attr("class"));

							//TODO 子要素にclassがあったらさらにタブで開く様にする
							if($('iframe').contents().find("."+classname).children().attr("class")) {
								// 親にクラスがあったらreturn
								if($('iframe').contents().find("."+classname).parent().attr("class")) return;

								// 子供の数だけループしてtab作成
								addTabTr(classname);
							} else {
								//addTr(classname);
								//console.log("子供いないぜ");
							}
							// if($('iframe').contents().find("."+classname).children().attr("class")) {
							// 	// 親にclassがあった場合 → return
							// 	if($('iframe').contents().find("."+classname).parent().attr("class")) {
							// 		//console.log($('iframe').contents().find("."+classname).parent().attr("class") +":"+ $('iframe').contents().find("."+classname).attr("class"));
							// 		return;
							// 	}
							// 	var childClassName = $('iframe').contents().find("."+classname).children().attr("class");

							// 	addTrAndTrInTdTab(classname,childClassName);
							// }
							// // 子要素にclassがない 
							// else {
							// 	// 親にclassがあった場合 → return
							// 	if($('iframe').contents().find("."+classname).parent().attr("class")) {
							// 		//console.log($('iframe').contents().find("."+classname).parent().attr("class") +":"+ $('iframe').contents().find("."+classname).attr("class"));
							// 		return;
							// 	}
							// 	addTr(classname);

							// 	addBackground(classname);

							// 	addBorder(classname);

							// 	addFont(classname);
							// }
						}
					});
				});
			</script>
		</div>
		<form method="post" id="sendForm" name="sendForm" action="/template/download">
			<div class="button">
				<input type="button" value="登録">
				<input type="submit" value="HTMLを書き出す" onClick="sendHTML();">
			</div>
		</form>
	</div>
  <div class="side">
    <div class="fixnav">
		<div class="tempButton">
			<a href="#"><button class="button1">テンプレート表示</button></a>
		</div>
      <div class="classTags">
				<div class="table-responsive">
					<table class="table table-hover">
						<thead>
						</thead>
						<tbody id="classTable">
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
}

				